# Hit Count Breakpoint Test (Go)
# Tests hit count breakpoint functionality

name: "Go Hit Count Breakpoint Test"
description: "Verifies hit count breakpoints stop after specified number of hits"

setup:
  - shell: "go build -gcflags='all=-N -l' -o tests/fixtures/test_simple_go tests/fixtures/simple.go"

target:
  program: "../fixtures/test_simple_go"
  args: []
  adapter: "go"
  stop_on_entry: true

steps:
  - action: command
    command: "break main.factorial --hit-count 3"
    expect:
      success: true

  - action: command
    command: "continue"

  - action: await
    timeout: 10
    expect:
      reason: "breakpoint"

  - action: inspect_stack
    asserts:
      - index: 0
        function: "main.factorial"

  # Remove breakpoints to avoid hitting them again during remaining recursive calls
  - action: command
    command: "breakpoint remove all"
    expect:
      success: true

  - action: command
    command: "continue"

  - action: await
    timeout: 10
    expect:
      reason: "terminated"
