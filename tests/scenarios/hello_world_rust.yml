# Rust Hello World Test
# Tests Rust debugging with lldb-dap or codelldb

name: "Rust Hello World Test"
description: "Verifies basic Rust debugging functionality"

# Compile the test program
setup:
  - shell: "rustc -g tests/e2e/hello_world.rs -o tests/e2e/test_rs"

# Debug target configuration
target:
  program: "../e2e/test_rs"
  args: []
  stop_on_entry: true

# Test steps
steps:
  # 1. Set a breakpoint at main
  - action: command
    command: "break main"
    expect:
      success: true

  # 2. Continue to the breakpoint
  - action: command
    command: "continue"

  # 3. Wait for stop at breakpoint
  - action: await
    timeout: 10
    expect:
      reason: "breakpoint"

  # 4. Step into
  - action: command
    command: "step"

  # 5. Wait for step
  - action: await
    timeout: 10
    expect:
      reason: "step"

  # 6. Check stack trace
  - action: inspect_stack
    asserts:
      - index: 0
        function: "main"

  # 7. Remove breakpoints to avoid hitting them again
  - action: command
    command: "breakpoint remove all"
    expect:
      success: true

  # 8. Continue to exit
  - action: command
    command: "continue"

  # 9. Wait for program exit
  - action: await
    timeout: 10
    expect:
      reason: "exited"
