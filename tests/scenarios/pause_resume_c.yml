# Pause/Resume Test (C)
# Tests pause command to stop running program
# Uses attach_target fixture which runs long enough to reliably pause

name: "C Pause/Resume Test"
description: "Verifies pause command stops a running program"

setup:
  - shell: "gcc -g tests/fixtures/attach_target.c -o tests/fixtures/test_attach_target"

target:
  program: "../fixtures/test_attach_target"
  args: []
  stop_on_entry: true

steps:
  # Set breakpoint in main loop to verify we can reach that code
  - action: command
    command: "break main"
    expect:
      success: true

  - action: command
    command: "continue"

  # Wait for breakpoint in main
  - action: await
    timeout: 10
    expect:
      reason: "breakpoint"

  # Remove all breakpoints and continue - program will start its 30-second loop
  - action: command
    command: "breakpoint remove all"
    expect:
      success: true

  - action: command
    command: "continue"

  # Pause the running program
  - action: command
    command: "pause"
    expect:
      success: true

  - action: await
    timeout: 10
    expect:
      reason: "pause"

  # Verify we're stopped somewhere in the program
  - action: command
    command: "backtrace"
    expect:
      success: true

  # Stop the debug session (don't wait for 30-second program to complete)
  - action: command
    command: "stop"
    expect:
      success: true
