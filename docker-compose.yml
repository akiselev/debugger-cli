# Docker Compose for local E2E testing
# Usage:
#   docker compose build         - Build all images
#   docker compose up lldb       - Run LLDB tests
#   docker compose up delve      - Run Delve tests
#   docker compose up debugpy    - Run debugpy tests
#   docker compose up js-debug   - Run js-debug tests
#   docker compose up gdb        - Run GDB tests
#   docker compose up            - Run all tests

services:
  # Base image - not runnable directly
  base:
    build:
      context: .
      dockerfile: docker/base/Dockerfile
    image: debugger-cli:base

  # LLDB tests - C/C++/Rust
  lldb:
    build:
      context: .
      dockerfile: docker/lldb/Dockerfile
    image: debugger-cli:lldb
    depends_on:
      - base
    volumes:
      - ./tests:/home/debugger/debugger-cli/tests:ro
      - test-results:/home/debugger/results

  # Delve tests - Go
  delve:
    build:
      context: .
      dockerfile: docker/delve/Dockerfile
    image: debugger-cli:delve
    depends_on:
      - base
    volumes:
      - ./tests:/home/debugger/debugger-cli/tests:ro
      - test-results:/home/debugger/results

  # debugpy tests - Python
  debugpy:
    build:
      context: .
      dockerfile: docker/debugpy/Dockerfile
    image: debugger-cli:debugpy
    depends_on:
      - base
    volumes:
      - ./tests:/home/debugger/debugger-cli/tests:ro
      - test-results:/home/debugger/results

  # js-debug tests - JavaScript/TypeScript
  js-debug:
    build:
      context: .
      dockerfile: docker/js-debug/Dockerfile
    image: debugger-cli:js-debug
    depends_on:
      - base
    volumes:
      - ./tests:/home/debugger/debugger-cli/tests:ro
      - test-results:/home/debugger/results

  # GDB tests - C/C++ with GDB
  gdb:
    build:
      context: .
      dockerfile: docker/gdb/Dockerfile
    image: debugger-cli:gdb
    depends_on:
      - base
    volumes:
      - ./tests:/home/debugger/debugger-cli/tests:ro
      - test-results:/home/debugger/results

volumes:
  test-results:
